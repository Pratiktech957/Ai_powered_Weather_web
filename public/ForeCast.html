<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MausamLive - Advanced Forecast Portal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --accent: #3b82f6;
            --dark: #f8fafc;
            --darker: #e2e8f0;
            --light: #ffffff;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --warning: #dc2626;
            --success: #059669;
            --border: #e2e8f0;
            --gradient-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark);
            color: var(--text-dark);
            line-height: 1.6;
        }

        header {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            background: var(--light);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-bottom: 3px solid var(--primary);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo i {
            font-size: 2rem;
            background: var(--gradient-bg);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo h1 {
            background: var(--gradient-bg);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.8rem;
            font-weight: 700;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        nav a:hover, nav a.active {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        main {
            margin-top: 100px;
            padding: 2rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-forecast {
            background: var(--gradient-bg);
            color: white;
            padding: 3rem 2rem;
            border-radius: 20px;
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-forecast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="white" opacity="0.1"><path d="M0,0v46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1057.25,10,1125,25c128.11,28.42,261.73,100.36,381.9,83.1,30.59-4.4,61.19-12.94,91.8-21.48V0Z"/></svg>') repeat-x;
            background-size: 1000px 100px;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1000px; }
        }

        .hero-forecast h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .hero-forecast p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .search-section {
            background: var(--light);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 3rem;
        }

        .search-container {
            display: flex;
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 1rem 1.5rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-btn, .ai-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-btn {
            background: var(--primary);
            color: white;
        }

        .search-btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
        }

        .ai-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .ai-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .current-weather {
            background: var(--light);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 3rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: center;
        }

        .weather-main {
            text-align: center;
        }

        .current-temp {
            font-size: 4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .weather-description {
            font-size: 1.5rem;
            color: var(--text-light);
            text-transform: capitalize;
        }

        .weather-icon {
            width: 120px;
            height: 120px;
            margin: 1rem auto;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .detail-item {
            text-align: center;
            padding: 1rem;
            background: var(--dark);
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .detail-item i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .detail-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .detail-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        .forecast-section {
            margin-bottom: 3rem;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .section-title i {
            color: var(--primary);
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .forecast-card {
            background: var(--light);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            text-align: center;
        }

        .forecast-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(37, 99, 235, 0.15);
            border-color: var(--primary);
        }

        .forecast-day {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .forecast-icon {
            width: 80px;
            height: 80px;
            margin: 1rem auto;
        }

        .forecast-temp {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .forecast-desc {
            color: var(--text-light);
            text-transform: capitalize;
            margin-bottom: 1rem;
        }

        .forecast-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .ai-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .ai-panel::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .ai-header i {
            font-size: 2rem;
        }

        .ai-header h3 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .ai-content {
            position: relative;
            z-index: 1;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .ai-loading {
            display: none;
            align-items: center;
            gap: 1rem;
        }

        .ai-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .chart-container {
            background: var(--light);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border: 2px solid var(--border);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-title i {
            color: var(--primary);
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .stat-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            background: var(--light);
            border-radius: 16px;
            border: 2px solid var(--border);
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        footer {
            background: var(--text-dark);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            border-radius: 20px;
            margin-top: 3rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: #cbd5e1;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            nav ul {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }

            main {
                margin-top: 140px;
                padding: 1rem;
            }

            .hero-forecast h1 {
                font-size: 2rem;
            }

            .search-container {
                flex-direction: column;
            }

            .current-weather {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .current-temp {
                font-size: 3rem;
            }

            .forecast-grid {
                grid-template-columns: 1fr;
            }

            .charts-section {
                grid-template-columns: 1fr;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .hero-forecast h1 {
                font-size: 1.8rem;
            }

            .current-temp {
                font-size: 2.5rem;
            }

            .quick-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-cloud-sun"></i>
                <h1>MausamLive</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="HomePage.html">Home</a></li>
                    <li><a href="ForeCast.html" class="active">Forecast</a></li>
                    <li><a href="alert1.html">Alerts</a></li>
                    <li><a href="Dashboard.html">FarmerForecast</a></li>
                    <li><a href="report.html">Reports</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero-forecast" data-aos="fade-down">
            <h1><i class="fas fa-chart-line"></i> Advanced Weather Forecast Portal</h1>
            <p>AI-powered weather predictions with government-grade accuracy and comprehensive analytics</p>
        </section>

        <section class="search-section" data-aos="fade-up">
            <div class="search-container">
                <input type="text" class="search-input" id="cityInput" placeholder="Enter city name or coordinates..." value="London">
                <button class="search-btn" onclick="searchWeather()">
                    <i class="fas fa-search"></i> Get Forecast
                </button>
                <button class="ai-btn" onclick="generateAIInsights()">
                    <i class="fas fa-brain"></i> AI Analysis
                </button>
                <button class="search-btn" onclick="getCurrentLocation()" style="background: #059669;">
                    <i class="fas fa-location-arrow"></i> My Location
                </button>
            </div>
        </section>

        <section class="current-weather" id="currentWeather" data-aos="fade-up">
            <div class="loading-container">
                <div class="spinner"></div>
            </div>
        </section>

        <section class="quick-stats" id="quickStats" data-aos="fade-up">
        </section>

        <section class="ai-panel" id="aiPanel" data-aos="fade-up">
            <div class="ai-header">
                <i class="fas fa-robot"></i>
                <h3>AI Weather Insights</h3>
            </div>
            <div class="ai-content" id="aiContent">
                <p>Click "AI Analysis" to get intelligent weather insights and recommendations based on current conditions and forecast data.</p>
            </div>
            <div class="ai-loading" id="aiLoading">
                <div class="ai-spinner"></div>
                <span>AI is analyzing weather patterns...</span>
            </div>
        </section>

        <section class="forecast-section" data-aos="fade-up">
            <h2 class="section-title">
                <i class="fas fa-calendar-week"></i>
                5-Day Weather Forecast
            </h2>
            <div class="forecast-grid" id="forecastGrid">
                <div class="loading-container">
                    <div class="spinner"></div>
                </div>
            </div>
        </section>

       
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="#api">API Documentation</a>
                <a href="#terms">Terms of Service</a>
                <a href="#privacy">Privacy Policy</a>
                <a href="#contact">Contact Support</a>
            </div>
            <p>&copy; 2025 MausamLive. Built with OpenWeather API & Advanced AI Analytics.</p>
            <p><small>Government-grade weather forecasting system</small></p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        AOS.init({
            duration: 800,
            once: true
        });

        let currentWeatherData = null;
        let forecastData = null;
        let tempChart = null;
        let humidityChart = null;

        let weatherHistory = [];

        document.addEventListener('DOMContentLoaded', function() {
            searchWeather();
        });

        async function searchWeather() {
            const city = document.getElementById('cityInput').value || 'London';
            showLoadingState();
            
            try {
                await Promise.all([
                    getCurrentWeather(city),
                    getForecast(city)
                ]);
                updateCharts();
            } catch (error) {
                console.error('Error fetching weather data:', error);
                showErrorState('Unable to fetch weather data. Please try again.');
            }
        }

        async function getCurrentWeather(city) {
            const response = await fetch(
                `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`
            );
            
            if (!response.ok) throw new Error('City not found');
            
            currentWeatherData = await response.json();
            displayCurrentWeather(currentWeatherData);
            updateQuickStats(currentWeatherData);
            checkWeatherAlerts();
        }

        async function getForecast(city) {
            const response = await fetch(
                `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`
            );
            
            if (!response.ok) throw new Error('Forecast data not available');
            
            const data = await response.json();
            forecastData = data.list.filter((item, index) => index % 8 === 0).slice(0, 5);
            displayForecast(forecastData);
            
            weatherHistory.push({
                city: city,
                current: currentWeatherData,
                forecast: forecastData,
                timestamp: new Date()
            });
        }

        function displayCurrentWeather(data) {
            const currentWeather = document.getElementById('currentWeather');
            const iconUrl = `https://openweathermap.org/img/wn/${data.weather[0].icon}@4x.png`;
            
            currentWeather.innerHTML = `
                <div class="weather-main">
                    <img src="${iconUrl}" alt="Weather Icon" class="weather-icon">
                    <div class="current-temp">${Math.round(data.main.temp)}¬∞C</div>
                    <div class="weather-description">${data.weather[0].description}</div>
                    <p><strong>${data.name}, ${data.sys.country}</strong></p>
                </div>
                <div class="weather-details">
                    <div class="detail-item">
                        <i class="fas fa-eye"></i>
                        <div class="detail-value">${(data.visibility / 1000).toFixed(1)} km</div>
                        <div class="detail-label">Visibility</div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-tint"></i>
                        <div class="detail-value">${data.main.humidity}%</div>
                        <div class="detail-label">Humidity</div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-wind"></i>
                        <div class="detail-value">${data.wind.speed} m/s</div>
                        <div class="detail-label">Wind Speed</div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-thermometer-half"></i>
                        <div class="detail-value">${Math.round(data.main.feels_like)}¬∞C</div>
                        <div class="detail-label">Feels Like</div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-compress-arrows-alt"></i>
                        <div class="detail-value">${data.main.pressure} hPa</div>
                        <div class="detail-label">Pressure</div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-sun"></i>
                        <div class="detail-value">${getUVIndex()}</div>
                        <div class="detail-label">UV Index</div>
                    </div>
                </div>
            `;
        }

        function updateQuickStats(data) {
            const quickStats = document.getElementById('quickStats');
            const stats = [
                {
                    icon: 'fas fa-thermometer-three-quarters',
                    value: `${Math.round(data.main.temp)}¬∞C`,
                    label: 'Temperature',
                    color: getTemperatureColor(data.main.temp)
                },
                {
                    icon: 'fas fa-tint',
                    value: `${data.main.humidity}%`,
                    label: 'Humidity',
                    color: getHumidityColor(data.main.humidity)
                },
                {
                    icon: 'fas fa-wind',
                    value: `${data.wind.speed} m/s`,
                    label: 'Wind Speed',
                    color: getWindColor(data.wind.speed)
                },
                {
                    icon: 'fas fa-eye',
                    value: `${(data.visibility / 1000).toFixed(1)} km`,
                    label: 'Visibility',
                    color: getVisibilityColor(data.visibility)
                }
            ];

            quickStats.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <i class="${stat.icon} stat-icon" style="color: ${stat.color}"></i>
                    <div class="stat-value" style="color: ${stat.color}">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }

        function displayForecast(data) {
            const forecastGrid = document.getElementById('forecastGrid');
            
            forecastGrid.innerHTML = data.map((item, index) => {
                const date = new Date(item.dt * 1000);
                const day = index === 0 ? 'Today' : date.toLocaleDateString('en-US', { weekday: 'long' });
                const fullDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const iconUrl = `https://openweathermap.org/img/wn/${item.weather[0].icon}@2x.png`;
                
                return `
                    <div class="forecast-card">
                        <div class="forecast-day">${day}</div>
                        <div style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 1rem;">${fullDate}</div>
                        <img src="${iconUrl}" alt="Weather Icon" class="forecast-icon">
                        <div class="forecast-temp">${Math.round(item.main.temp)}¬∞C</div>
                        <div class="forecast-desc">${item.weather[0].description}</div>
                        <div class="forecast-details">
                            <span><i class="fas fa-arrow-up"></i> ${Math.round(item.main.temp_max)}¬∞</span>
                            <span><i class="fas fa-arrow-down"></i> ${Math.round(item.main.temp_min)}¬∞</span>
                            <span><i class="fas fa-tint"></i> ${item.main.humidity}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }


        async function generateAIInsights() {
            if (!currentWeatherData || !forecastData) {
                alert('Please load weather data first');
                return;
            }

            const aiContent = document.getElementById('aiContent');
            const aiLoading = document.getElementById('aiLoading');
            
            aiContent.style.display = 'none';
            aiLoading.style.display = 'flex';

            setTimeout(() => {
                const insights = generateAdvancedWeatherInsights();
                aiContent.innerHTML = insights;
                aiContent.style.display = 'block';
                aiLoading.style.display = 'none';
            }, 3000); 
        }

        function generateAdvancedWeatherInsights() {
            const current = currentWeatherData;
            const forecast = forecastData;
            
            let insights = [];
            let riskLevel = 0;
            let recommendations = [];
            
            const temps = forecast.map(day => day.main.temp);
            const tempVariance = calculateVariance(temps);
            const tempTrend = calculateTrend(temps);
            const avgTemp = temps.reduce((sum, temp) => sum + temp, 0) / temps.length;
            
            insights.push(`üß† <strong>AI Temperature Analysis:</strong> Detected ${tempVariance > 25 ? 'high' : 'moderate'} temperature volatility. ${tempTrend > 0 ? 'Rising' : 'Declining'} trend with ${Math.abs(tempTrend).toFixed(1)}¬∞C change predicted.`);
            
            const currentPressure = current.main.pressure;
            let pressureInsight = '';
            if (currentPressure < 980) {
                pressureInsight = 'Very low pressure system detected - potential for severe weather.';
                riskLevel += 3;
            } else if (currentPressure < 1000) {
                pressureInsight = 'Low pressure system - increased chance of precipitation.';
                riskLevel += 2;
            } else if (currentPressure > 1030) {
                pressureInsight = 'High pressure system - stable, clear weather expected.';
                riskLevel -= 1;
            } else {
                pressureInsight = 'Normal atmospheric pressure - stable conditions.';
            }
            insights.push(`üåç <strong>Atmospheric Analysis:</strong> ${pressureInsight} (${currentPressure} hPa)`);

            const windSpeeds = forecast.map(day => day.wind.speed);
            const maxWind = Math.max(...windSpeeds);
            const avgWind = windSpeeds.reduce((sum, speed) => sum + speed, 0) / windSpeeds.length;
            
            if (maxWind > 15) {
                insights.push(`üí® <strong>Wind Risk Assessment:</strong> Strong winds predicted (max: ${maxWind.toFixed(1)} m/s). Secure outdoor objects and avoid high-profile vehicles.`);
                riskLevel += 2;
                recommendations.push('‚ö†Ô∏è Avoid outdoor activities during peak wind hours');
            } else if (avgWind > 8) {
                insights.push(`üå¨Ô∏è <strong>Wind Conditions:</strong> Moderate winds throughout the period. Good for outdoor activities with wind consideration.`);
                recommendations.push('üéØ Perfect conditions for kite flying and sailing');
            }

            const humidityLevels = forecast.map(day => day.main.humidity);
            const avgHumidity = humidityLevels.reduce((sum, h) => sum + h, 0) / humidityLevels.length;
            const comfortIndex = calculateComfortIndex(avgTemp, avgHumidity, avgWind);
            
            insights.push(`üíß <strong>Comfort Analysis:</strong> Average humidity ${avgHumidity.toFixed(1)}%. Comfort index: ${comfortIndex}/10 ${getComfortDescription(comfortIndex)}`);

            const weatherTypes = forecast.map(day => day.weather[0].main);
            const weatherPattern = analyzeWeatherPattern(weatherTypes);
            insights.push(`üîÆ <strong>Pattern Recognition:</strong> ${weatherPattern.description} Confidence: ${weatherPattern.confidence}%`);

            const activityScores = calculateActivityScores(current, forecast);
            recommendations.push(...getTopActivities(activityScores));

            const riskAssessment = getRiskAssessment(riskLevel);
            insights.push(`‚ö° <strong>Risk Level:</strong> ${riskAssessment.level} - ${riskAssessment.description}`);

            const aqiPrediction = predictAQI(current);
            insights.push(`üå´Ô∏è <strong>Air Quality Prediction:</strong> ${aqiPrediction.description} (Estimated AQI: ${aqiPrediction.value})`);

            const seasonalInsight = getSeasonalInsight(current, forecast);
            if (seasonalInsight) {
                insights.push(`üçÇ <strong>Seasonal Context:</strong> ${seasonalInsight}`);
            }

            const healthInsights = analyzeHealthImpact(current, forecast);
            insights.push(...healthInsights);

            const energyInsight = predictEnergyConsumption(current, forecast);
            insights.push(`‚ö° <strong>Energy Impact:</strong> ${energyInsight}`);

            return `
                <div style="display: flex; flex-direction: column; gap: 1.2rem;">
                    ${insights.map(insight => `<p style="line-height: 1.6;">${insight}</p>`).join('')}
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 8px; border-left: 4px solid #ffd700;">
                        <h4 style="margin-bottom: 0.8rem; color: #ffd700;"><i class="fas fa-star"></i> AI Recommendations</h4>
                        ${recommendations.map(rec => `<p style="margin: 0.5rem 0; font-size: 0.95rem;">${rec}</p>`).join('')}
                    </div>
                    
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.3); font-size: 0.85rem; opacity: 0.9;">
                        <p><i class="fas fa-brain"></i> Analysis powered by advanced meteorological algorithms and pattern recognition</p>
                        <p><i class="fas fa-clock"></i> Last updated: ${new Date().toLocaleString()}</p>
                    </div>
                </div>
            `;
        }

        function calculateVariance(values) {
            const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
            const squaredDiffs = values.map(val => Math.pow(val - mean, 2));
            return squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;
        }

        function calculateTrend(values) {
            let trend = 0;
            for (let i = 1; i < values.length; i++) {
                trend += values[i] - values[i-1];
            }
            return trend / (values.length - 1);
        }

        function calculateComfortIndex(temp, humidity, wind) {
            let comfort = 5; 
            
            if (temp >= 20 && temp <= 25) comfort += 2;
            else if (temp >= 15 && temp <= 30) comfort += 1;
            else if (temp < 10 || temp > 35) comfort -= 2;
            else comfort -= 1;
            
            if (humidity >= 40 && humidity <= 60) comfort += 1;
            else if (humidity > 80) comfort -= 2;
            else if (humidity < 30) comfort -= 1;
            
            if (wind > 15) comfort -= 2;
            else if (wind > 10) comfort -= 1;
            else if (wind >= 2 && wind <= 8) comfort += 1;
            
            return Math.max(0, Math.min(10, comfort));
        }

        function getComfortDescription(index) {
            if (index >= 8) return '(Excellent conditions)';
            if (index >= 6) return '(Very comfortable)';
            if (index >= 4) return '(Comfortable)';
            if (index >= 2) return '(Somewhat uncomfortable)';
            return '(Uncomfortable conditions)';
        }

        function analyzeWeatherPattern(weatherTypes) {
            const patterns = {
                'stable_clear': { keywords: ['Clear'], confidence: 95, description: 'Stable high-pressure system with clear skies' },
                'unstable_mixed': { keywords: ['Clear', 'Clouds', 'Rain'], confidence: 85, description: 'Unstable weather pattern with mixed conditions' },
                'rain_period': { keywords: ['Rain'], confidence: 90, description: 'Persistent low-pressure system with rainfall' },
                'cloudy_period': { keywords: ['Clouds'], confidence: 80, description: 'Overcast conditions with stable cloud cover' }
            };

            const clearDays = weatherTypes.filter(w => w === 'Clear').length;
            const rainDays = weatherTypes.filter(w => w.includes('Rain')).length;
            const cloudyDays = weatherTypes.filter(w => w.includes('Clouds')).length;

            if (clearDays >= 3) return patterns.stable_clear;
            if (rainDays >= 2) return patterns.rain_period;
            if (cloudyDays >= 3) return patterns.cloudy_period;
            return patterns.unstable_mixed;
        }

        function calculateActivityScores(current, forecast) {
            const scores = {
                'Outdoor Sports': 0,
                'Beach/Swimming': 0,
                'Hiking/Walking': 0,
                'Photography': 0,
                'Indoor Activities': 0,
                'Gardening': 0,
                'Cycling': 0,
                'Picnic': 0
            };

            const avgTemp = forecast.reduce((sum, day) => sum + day.main.temp, 0) / forecast.length;
            const rainDays = forecast.filter(day => day.weather[0].main.includes('Rain')).length;
            const avgWind = forecast.reduce((sum, day) => sum + day.wind.speed, 0) / forecast.length;

            if (avgTemp > 15 && avgTemp < 28 && rainDays < 2 && avgWind < 12) {
                scores['Outdoor Sports'] = 85 + Math.random() * 15;
            } else if (rainDays > 2) {
                scores['Indoor Activities'] = 90 + Math.random() * 10;
            }

            if (avgTemp > 25 && current.weather[0].main === 'Clear') {
                scores['Beach/Swimming'] = 90 + Math.random() * 10;
            }

            scores['Hiking/Walking'] = avgTemp > 10 && avgTemp < 30 && rainDays < 2 ? 80 + Math.random() * 20 : 40 + Math.random() * 30;
            scores['Photography'] = current.weather[0].main === 'Clear' ? 85 + Math.random() * 15 : 60 + Math.random() * 20;
            scores['Cycling'] = avgTemp > 12 && avgWind < 15 && rainDays < 2 ? 85 + Math.random() * 15 : 50 + Math.random() * 25;

            return scores;
        }

        function getTopActivities(scores) {
            const sorted = Object.entries(scores)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3);

            return sorted.map(([activity, score]) => 
                `üéØ ${activity}: ${Math.round(score)}% optimal conditions`
            );
        }

        function getRiskAssessment(riskLevel) {
            if (riskLevel >= 5) return { level: 'HIGH', description: 'Multiple weather hazards detected. Exercise extreme caution.' };
            if (riskLevel >= 3) return { level: 'MODERATE', description: 'Some weather concerns. Stay alert and prepared.' };
            if (riskLevel >= 1) return { level: 'LOW', description: 'Minor weather considerations. Generally safe conditions.' };
            return { level: 'MINIMAL', description: 'Excellent weather conditions with minimal risks.' };
        }

        function predictAQI(current) {
            const visibility = current.visibility / 1000;
            const humidity = current.main.humidity;
            const wind = current.wind.speed;

            let aqi = 50; // Base AQI

            if (visibility < 5) aqi += 30;
            else if (visibility < 10) aqi += 15;

            if (humidity > 85) aqi += 10;
            if (wind < 3) aqi += 20;

            const aqiValue = Math.min(150, aqi);
            
            let description;
            if (aqiValue <= 50) description = 'Good - Air quality is satisfactory';
            else if (aqiValue <= 100) description = 'Moderate - Acceptable for most people';
            else description = 'Unhealthy for sensitive groups - Consider limiting outdoor exposure';

            return { value: aqiValue, description };
        }

        function getSeasonalInsight(current, forecast) {
            const month = new Date().getMonth();
            const temp = current.main.temp;

            if (month >= 5 && month <= 7) { 
                if (temp > 35) return 'Extreme summer heat - This is above seasonal averages. Stay hydrated and seek shade.';
                if (temp > 30) return 'Typical summer conditions with high temperatures. Perfect for summer activities.';
            } else if (month >= 11 || month <= 1) { 
                if (temp < -5) return 'Harsh winter conditions - Below seasonal norms. Dress warmly and check on neighbors.';
                if (temp > 15) return 'Unusually warm for winter season - Climate pattern anomaly detected.';
            }
            
            return null;
        }

        function analyzeHealthImpact(current, forecast) {
            const insights = [];
            const temp = current.main.temp;
            const humidity = current.main.humidity;
            const pressure = current.main.pressure;

            if (temp > 32) {
                insights.push('üè• <strong>Heat Health Alert:</strong> High risk of heat exhaustion. Increase fluid intake and limit outdoor exposure.');
            }

            if (humidity > 85 && temp > 25) {
                insights.push('ü´Å <strong>Respiratory Advisory:</strong> High humidity may affect those with breathing difficulties.');
            }

            if (pressure < 995) {
                insights.push('üß† <strong>Barometric Pressure Alert:</strong> Low pressure may trigger headaches and joint pain in sensitive individuals.');
            }

            return insights;
        }

        function predictEnergyConsumption(current, forecast) {
            const avgTemp = forecast.reduce((sum, day) => sum + day.main.temp, 0) / forecast.length;
            
            if (avgTemp > 28) {
                return 'High cooling demand expected - Consider energy-saving measures and peak hour usage reduction.';
            } else if (avgTemp < 10) {
                return 'Increased heating requirements - Optimize home insulation and heating schedules.';
            } else {
                return 'Moderate energy consumption expected - Ideal conditions for natural ventilation.';
            }
        }

        function updateCharts() {
            if (!forecastData || forecastData.length === 0) {
                console.log('No forecast data available for charts');
                return;
            }
            
            setTimeout(() => {
                updateTemperatureChart();
                updateHumidityChart();
            }, 100);
        }

        function updateTemperatureChart() {
            try {
                const canvas = document.getElementById('tempChart');
                if (!canvas) {
                    console.error('Temperature chart canvas not found');
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                
                if (tempChart) {
                    tempChart.destroy();
                }

                if (!forecastData || forecastData.length === 0) {
                    ctx.fillStyle = '#64748b';
                    ctx.font = '16px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText('Loading temperature data...', canvas.width/2, canvas.height/2);
                    return;
                }

                const labels = forecastData.map((item, index) => {
                    const date = new Date(item.dt * 1000);
                    return index === 0 ? 'Today' : date.toLocaleDateString('en-US', { weekday: 'short' });
                });

                const temperatures = forecastData.map(item => Math.round(item.main.temp));
                const feelsLike = forecastData.map(item => Math.round(item.main.feels_like));
                const maxTemps = forecastData.map(item => Math.round(item.main.temp_max));
                const minTemps = forecastData.map(item => Math.round(item.main.temp_min));

                tempChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Temperature (¬∞C)',
                            data: temperatures,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: '+1',
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        }, {
                            label: 'Feels Like (¬∞C)',
                            data: feelsLike,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: '#f59e0b',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2
                        }, {
                            label: 'Max Temp (¬∞C)',
                            data: maxTemps,
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.05)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 3,
                            pointBackgroundColor: '#dc2626'
                        }, {
                            label: 'Min Temp (¬∞C)',
                            data: minTemps,
                            borderColor: '#06b6d4',
                            backgroundColor: 'rgba(6, 182, 212, 0.05)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 3,
                            pointBackgroundColor: '#06b6d4'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '¬∞C';
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#3b82f6',
                                borderWidth: 1
                            }
                        }
                    }
                });
                
                console.log('Temperature chart updated successfully');
            } catch (error) {
                console.error('Error updating temperature chart:', error);
            }
        }

        function updateHumidityChart() {
            try {
                const canvas = document.getElementById('humidityChart');
                if (!canvas) {
                    console.error('Humidity chart canvas not found');
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                
                if (humidityChart) {
                    humidityChart.destroy();
                }

                if (!forecastData || forecastData.length === 0) {
                    ctx.fillStyle = '#64748b';
                    ctx.font = '16px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText('Loading humidity data...', canvas.width/2, canvas.height/2);
                    return;
                }

                const labels = forecastData.map((item, index) => {
                    const date = new Date(item.dt * 1000);
                    return index === 0 ? 'Today' : date.toLocaleDateString('en-US', { weekday: 'short' });
                });

                const humidity = forecastData.map(item => item.main.humidity);
                const precipitation = forecastData.map(item => {
                    return item.rain ? (item.rain['3h'] || 0) : 0;
                });
                const windSpeed = forecastData.map(item => item.wind.speed);

                humidityChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Humidity (%)',
                            data: humidity,
                            backgroundColor: humidity.map(h => 
                                h > 80 ? 'rgba(34, 197, 94, 0.8)' : 
                                h > 60 ? 'rgba(34, 197, 94, 0.6)' : 
                                'rgba(34, 197, 94, 0.4)'
                            ),
                            borderColor: '#22c55e',
                            borderWidth: 2,
                            yAxisID: 'y',
                            borderRadius: 4
                        }, {
                            label: 'Precipitation (mm)',
                            data: precipitation,
                            type: 'line',
                            borderColor: '#06b6d4',
                            backgroundColor: 'rgba(6, 182, 212, 0.2)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#06b6d4',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            yAxisID: 'y1'
                        }, {
                            label: 'Wind Speed (m/s)',
                            data: windSpeed,
                            type: 'line',
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: '#8b5cf6',
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                max: 100,
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false,
                                    color: 'rgba(0,0,0,0.1)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + ' mm/m/s';
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#22c55e',
                                borderWidth: 1
                            }
                        }
                    }
                });
                
                console.log('Humidity chart updated successfully');
            } catch (error) {
                console.error('Error updating humidity chart:', error);
            }
        }

        function showLoadingState() {
            document.getElementById('currentWeather').innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                </div>
            `;
            document.getElementById('forecastGrid').innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                </div>
            `;
        }

        function showErrorState(message) {
            document.getElementById('currentWeather').innerHTML = `
                <div style="text-align: center; padding: 3rem; color: var(--warning);">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                    <h3>Error Loading Weather Data</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        function getTemperatureColor(temp) {
            if (temp > 30) return '#dc2626';
            if (temp > 20) return '#f59e0b';
            if (temp > 10) return '#3b82f6';
            return '#06b6d4';
        }

        function getHumidityColor(humidity) {
            if (humidity > 80) return '#0ea5e9';
            if (humidity > 60) return '#3b82f6';
            if (humidity > 40) return '#6366f1';
            return '#8b5cf6';
        }

        function getWindColor(speed) {
            if (speed > 15) return '#dc2626';
            if (speed > 10) return '#f59e0b';
            if (speed > 5) return '#22c55e';
            return '#3b82f6';
        }

        function getVisibilityColor(visibility) {
            const km = visibility / 1000;
            if (km > 10) return '#22c55e';
            if (km > 5) return '#f59e0b';
            return '#dc2626';
        }

        function getUVIndex() {
            if (!currentWeatherData) return 'N/A';
            
            const hour = new Date().getHours();
            const condition = currentWeatherData.weather[0].main;
            
            if (condition === 'Clear' && hour >= 10 && hour <= 16) {
                return Math.floor(Math.random() * 5) + 6; // 6-10 (High)
            } else if (condition === 'Clear') {
                return Math.floor(Math.random() * 3) + 3; // 3-5 (Moderate)
            } else {
                return Math.floor(Math.random() * 3) + 1; // 1-3 (Low)
            }
        }

        function checkWeatherAlerts() {
            if (!currentWeatherData) return;

            const alerts = [];
            const temp = currentWeatherData.main.temp;
            const humidity = currentWeatherData.main.humidity;
            const windSpeed = currentWeatherData.wind.speed;
            const condition = currentWeatherData.weather[0].main;

            if (temp > 35) alerts.push('‚ö†Ô∏è Extreme Heat Warning');
            if (temp < -10) alerts.push('ü•∂ Extreme Cold Warning');
            if (humidity > 90) alerts.push('üíß High Humidity Alert');
            if (windSpeed > 20) alerts.push('üí® Strong Wind Advisory');
            if (condition.includes('Thunder')) alerts.push('‚õàÔ∏è Thunderstorm Alert');

            if (alerts.length > 0) {
                console.log('Weather Alerts:', alerts);
            }
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        getWeatherByCoords(lat, lon);
                    },
                    error => {
                        console.error('Geolocation error:', error);
                        alert('Unable to get your location. Please enter city manually.');
                    }
                );
            }
        }

        async function getWeatherByCoords(lat, lon) {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`
                );
                const data = await response.json();
                document.getElementById('cityInput').value = data.name;
                searchWeather();
            } catch (error) {
                console.error('Error fetching weather by coordinates:', error);
            }
        }

        document.getElementById('cityInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchWeather();
            }
        });

        setInterval(() => {
            if (document.getElementById('cityInput').value) {
                searchWeather();
            }
        }, 600000);

        document.addEventListener('click', function(e) {
            if (e.target.closest('.forecast-card')) {
                const card = e.target.closest('.forecast-card');
                card.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    card.style.transform = '';
                }, 150);
            }
        });

        document.querySelectorAll('nav a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });

        function processWeatherData(data) {
            const processed = {
                ...data,
                comfort_level: calculateComfortLevel(data),
                air_quality_estimate: estimateAirQuality(data),
                clothing_recommendation: getClothingRecommendation(data),
                activity_suitability: getActivitySuitability(data)
            };
            return processed;
        }

        function calculateComfortLevel(data) {
            const temp = data.main.temp;
            const humidity = data.main.humidity;
            const wind = data.wind.speed;
            
            let heatIndex = temp;
            if (temp > 26) {
                heatIndex = -8.78469475556 + 1.61139411 * temp + 2.33854883889 * humidity;
            }
            
            let comfort = 'comfortable';
            if (heatIndex > 40) comfort = 'dangerous';
            else if (heatIndex > 32) comfort = 'very uncomfortable';
            else if (heatIndex > 27) comfort = 'uncomfortable';
            else if (temp < 10) comfort = 'cold';
            else if (temp < 0) comfort = 'very cold';
            
            return {
                level: comfort,
                heat_index: Math.round(heatIndex),
                wind_chill: temp < 10 ? Math.round(13.12 + 0.6215 * temp - 11.37 * Math.pow(wind * 3.6, 0.16) + 0.3965 * temp * Math.pow(wind * 3.6, 0.16)) : null
            };
        }

        function estimateAirQuality(data) {
            const visibility = data.visibility / 1000;
            const humidity = data.main.humidity;
            const wind = data.wind.speed;
            
            let aqi = 50;
            if (visibility < 1) aqi += 100;
            else if (visibility < 5) aqi += 50;
            else if (visibility < 10) aqi += 20;
            
            if (humidity > 90) aqi += 15;
            if (wind < 2) aqi += 25;
            
            aqi = Math.min(300, Math.max(0, aqi));
            
            let quality = 'Good';
            if (aqi > 150) quality = 'Unhealthy';
            else if (aqi > 100) quality = 'Unhealthy for Sensitive Groups';
            else if (aqi > 50) quality = 'Moderate';
            
            return {
                estimated_aqi: Math.round(aqi),
                quality_level: quality,
                recommendation: aqi > 100 ? 'Consider limiting outdoor activities' : 'Air quality is acceptable'
            };
        }

        function getClothingRecommendation(data) {
            const temp = data.main.temp;
            const condition = data.weather[0].main;
            const wind = data.wind.speed;
            const humidity = data.main.humidity;
            
            let recommendations = [];
            
            if (temp > 30) {
                recommendations.push('Light, breathable fabrics');
                recommendations.push('Sun hat and sunglasses');
                recommendations.push('Light colors to reflect heat');
            } else if (temp > 20) {
                recommendations.push('Light layers');
                recommendations.push('Comfortable casual wear');
            } else if (temp > 10) {
                recommendations.push('Light jacket or sweater');
                recommendations.push('Long pants');
            } else if (temp > 0) {
                recommendations.push('Warm coat');
                recommendations.push('Gloves and scarf');
            } else {
                recommendations.push('Heavy winter coat');
                recommendations.push('Warm layers, gloves, hat');
                recommendations.push('Waterproof boots');
            }
            
            if (condition.includes('Rain')) {
                recommendations.push('Waterproof jacket or umbrella');
                recommendations.push('Water-resistant footwear');
            }
            
            if (wind > 15) {
                recommendations.push('Windproof outer layer');
            }
            
            if (humidity > 80 && temp > 25) {
                recommendations.push('Moisture-wicking fabrics');
            }
            
            return recommendations.slice(0, 4); 
        }

        function getActivitySuitability(data) {
            const temp = data.main.temp;
            const condition = data.weather[0].main;
            const wind = data.wind.speed;
            const humidity = data.main.humidity;
            const visibility = data.visibility / 1000;
            
            const activities = {
                'Running/Jogging': 0,
                'Cycling': 0,
                'Hiking': 0,
                'Beach Activities': 0,
                'Photography': 0,
                'Picnic': 0,
                'Golf': 0,
                'Tennis': 0,
                'Swimming': 0,
                'Skiing/Winter Sports': 0
            };
            
            if (temp >= 15 && temp <= 25) {
                activities['Running/Jogging'] += 30;
                activities['Cycling'] += 30;
                activities['Hiking'] += 30;
                activities['Golf'] += 25;
                activities['Tennis'] += 25;
            }
            
            if (temp >= 25 && temp <= 35) {
                activities['Beach Activities'] += 40;
                activities['Swimming'] += 35;
                activities['Picnic'] += 20;
            }
            
            if (temp < 5) {
                activities['Skiing/Winter Sports'] += 40;
            }
            
            if (condition === 'Clear') {
                Object.keys(activities).forEach(activity => {
                    if (!activity.includes('Winter')) activities[activity] += 25;
                });
                activities['Photography'] += 30;
                activities['Beach Activities'] += 25;
            }
            
            if (condition.includes('Rain')) {
                Object.keys(activities).forEach(activity => {
                    activities[activity] -= 40;
                });
            }
            
            if (condition.includes('Snow')) {
                activities['Skiing/Winter Sports'] += 30;
                Object.keys(activities).forEach(activity => {
                    if (!activity.includes('Winter') && !activity.includes('Skiing')) {
                        activities[activity] -= 30;
                    }
                });
            }
            
            if (wind > 20) {
                activities['Cycling'] -= 25;
                activities['Golf'] -= 20;
                activities['Tennis'] -= 15;
            }
            
            if (visibility < 5) {
                activities['Hiking'] -= 20;
                activities['Photography'] -= 25;
            }
            
            Object.keys(activities).forEach(activity => {
                activities[activity] = Math.max(0, Math.min(100, activities[activity] + 50));
            });
            
            return activities;
        }

        function processExtendedForecast(forecastList) {
            const dailyData = {};
            
            forecastList.forEach(item => {
                const date = new Date(item.dt * 1000).toDateString();
                if (!dailyData[date]) {
                    dailyData[date] = {
                        temps: [],
                        humidity: [],
                        wind: [],
                        conditions: [],
                        pressure: [],
                        timestamp: item.dt
                    };
                }
                
                dailyData[date].temps.push(item.main.temp);
                dailyData[date].humidity.push(item.main.humidity);
                dailyData[date].wind.push(item.wind.speed);
                dailyData[date].conditions.push(item.weather[0].main);
                dailyData[date].pressure.push(item.main.pressure);
            });
            
            const processedDays = Object.keys(dailyData).slice(0, 7).map(date => {
                const day = dailyData[date];
                return {
                    date: date,
                    timestamp: day.timestamp,
                    temp_avg: day.temps.reduce((a, b) => a + b, 0) / day.temps.length,
                    temp_max: Math.max(...day.temps),
                    temp_min: Math.min(...day.temps),
                    humidity_avg: day.humidity.reduce((a, b) => a + b, 0) / day.humidity.length,
                    wind_avg: day.wind.reduce((a, b) => a + b, 0) / day.wind.length,
                    wind_max: Math.max(...day.wind),
                    pressure_avg: day.pressure.reduce((a, b) => a + b, 0) / day.pressure.length,
                    dominant_condition: getDominantCondition(day.conditions),
                    condition_changes: [...new Set(day.conditions)].length,
                    weather_stability: calculateWeatherStability(day)
                };
            });
            
            return processedDays;
        }

        function getDominantCondition(conditions) {
            const counts = {};
            conditions.forEach(condition => {
                counts[condition] = (counts[condition] || 0) + 1;
            });
            
            return Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
        }

        function calculateWeatherStability(dayData) {
            const tempRange = Math.max(...dayData.temps) - Math.min(...dayData.temps);
            const pressureVariation = Math.max(...dayData.pressure) - Math.min(...dayData.pressure);
            const conditionChanges = [...new Set(dayData.conditions)].length;
            
            let stability = 100;
            if (tempRange > 15) stability -= 30;
            else if (tempRange > 10) stability -= 20;
            else if (tempRange > 5) stability -= 10;
            
            if (pressureVariation > 10) stability -= 20;
            else if (pressureVariation > 5) stability -= 10;
            
            stability -= (conditionChanges - 1) * 15;
            
            return Math.max(0, Math.min(100, stability));
        }

        function compareWithHistorical(currentData) {
            const month = new Date().getMonth();
            const historicalAverage = getHistoricalAverage(month);
            
            return {
                temperature_vs_average: currentData.main.temp - historicalAverage.temp,
                humidity_vs_average: currentData.main.humidity - historicalAverage.humidity,
                pressure_vs_average: currentData.main.pressure - historicalAverage.pressure,
                is_unusual: Math.abs(currentData.main.temp - historicalAverage.temp) > 10
            };
        }

        function getHistoricalAverage(month) {
            const monthlyAverages = [
                { temp: 5, humidity: 75, pressure: 1013 },   
                { temp: 7, humidity: 70, pressure: 1015 },   
                { temp: 12, humidity: 65, pressure: 1012 },  
                { temp: 16, humidity: 60, pressure: 1010 },  
                { temp: 21, humidity: 58, pressure: 1008 },
                { temp: 25, humidity: 62, pressure: 1006 }, 
                { temp: 28, humidity: 65, pressure: 1004 }, 
                { temp: 27, humidity: 67, pressure: 1005 },  
                { temp: 23, humidity: 70, pressure: 1008 },  
                { temp: 18, humidity: 72, pressure: 1011 },  
                { temp: 12, humidity: 78, pressure: 1014 },  
                { temp: 7, humidity: 80, pressure: 1016 }    
            ];
            
            return monthlyAverages[month];
        }

        function generateAdvancedAlerts(current, forecast) {
            const alerts = [];
            
            // Temperature alerts
            const tempChange = forecast[1].main.temp - current.main.temp;
            if (Math.abs(tempChange) > 10) {
                alerts.push({
                    type: 'temperature_change',
                    severity: 'moderate',
                    title: 'Significant Temperature Change',
                    message: `Temperature will ${tempChange > 0 ? 'rise' : 'drop'} by ${Math.abs(tempChange).toFixed(1)}¬∞C tomorrow`,
                    icon: 'fas fa-thermometer-half'
                });
            }
            
            if (current.main.pressure < 980) {
                alerts.push({
                    type: 'low_pressure',
                    severity: 'high',
                    title: 'Very Low Atmospheric Pressure',
                    message: 'Storm conditions possible. Secure loose objects and avoid unnecessary travel.',
                    icon: 'fas fa-exclamation-triangle'
                });
            }
            
            const maxWind = Math.max(...forecast.map(f => f.wind.speed));
            if (maxWind > 20) {
                alerts.push({
                    type: 'high_wind',
                    severity: 'high',
                    title: 'High Wind Warning',
                    message: `Wind speeds up to ${maxWind.toFixed(1)} m/s expected. Avoid outdoor activities.`,
                    icon: 'fas fa-wind'
                });
            }
            
            if (current.visibility < 1000) {
                alerts.push({
                    type: 'low_visibility',
                    severity: 'moderate',
                    title: 'Poor Visibility',
                    message: 'Fog or haze reducing visibility. Drive carefully and use headlights.',
                    icon: 'fas fa-eye-slash'
                });
            }
            
            return alerts;
        }

        function analyzeTrends(forecastData) {
            if (!forecastData || forecastData.length < 3) return null;
            
            const temps = forecastData.map(f => f.main.temp);
            const pressures = forecastData.map(f => f.main.pressure);
            const humidity = forecastData.map(f => f.main.humidity);
            
            return {
                temperature: {
                    trend: calculateTrendDirection(temps),
                    volatility: calculateVolatility(temps),
                    range: Math.max(...temps) - Math.min(...temps)
                },
                pressure: {
                    trend: calculateTrendDirection(pressures),
                    volatility: calculateVolatility(pressures),
                    range: Math.max(...pressures) - Math.min(...pressures)
                },
                humidity: {
                    trend: calculateTrendDirection(humidity),
                    volatility: calculateVolatility(humidity),
                    range: Math.max(...humidity) - Math.min(...humidity)
                }
            };
        }

        function calculateTrendDirection(values) {
            let increases = 0;
            let decreases = 0;
            
            for (let i = 1; i < values.length; i++) {
                if (values[i] > values[i-1]) increases++;
                else if (values[i] < values[i-1]) decreases++;
            }
            
            if (increases > decreases) return 'increasing';
            else if (decreases > increases) return 'decreasing';
            else return 'stable';
        }

        function calculateVolatility(values) {
            const mean = values.reduce((a, b) => a + b, 0) / values.length;
            const squaredDiffs = values.map(v => Math.pow(v - mean, 2));
            const variance = squaredDiffs.reduce((a, b) => a + b, 0) / values.length;
            return Math.sqrt(variance);
        }
    </script>
</body>
</html>